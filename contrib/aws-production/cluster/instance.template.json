{
  "Type": "AWS::EC2::Instance",
  "Properties": {
    "ImageId" : { "Fn::FindInMap" : [ "CoreOSAMIs", { "Ref" : "AWS::Region" }, { "Ref" : "EC2VirtualizationType" }]},
    "InstanceType": {"Ref": "InstanceType"},
    "IamInstanceProfile" : {
      "Fn::If" : [
        "UseIamInstanceProfile",
        { "Ref" : "IamInstanceProfile" },
        { "Ref" : "AWS::NoValue" }
      ]
    },
    "DisableApiTermination" : true,
    "Monitoring" : true,
    "KeyName": {"Ref": "KeyPair"},
    "UserData" : { "Fn::Base64": { "Fn::Join": [ "", [ ] ] } },
    "NetworkInterfaces": [
      {
        "AssociatePublicIpAddress": "false",
        "DeviceIndex": "0",
        "GroupSet": [{ "Fn::GetAtt": ["CoreOSSecurityGroup", "GroupId"] } ],
        "SubnetId": { "Fn::FindInMap" : [ "VPCSubnets", "AZ", "private" ] }
      }
    ],
    "BlockDeviceMappings" : [
      {
        "DeviceName" : { "Fn::FindInMap": [ "RootDevices", { "Ref": "EC2VirtualizationType" }, "Name" ] },
        "Ebs" : { "VolumeSize" : { "Ref": "RootVolumeSize" }, "VolumeType": { "Ref": "EC2EBSVolumeType" } }
      },
      {
        "DeviceName" : "/dev/xvdf",
        "Ebs" : { "VolumeSize" : { "Ref": "DockerVolumeSize" }, "VolumeType": { "Ref": "EC2EBSVolumeType" } }
      },
      {
        "DeviceName" : "/dev/xvdg",
        "Ebs" : { "VolumeSize" : { "Ref": "EtcdVolumeSize" }, "VolumeType": { "Ref": "EC2EBSVolumeType" } }
      }
    ],
    "Tags" : []
  },
  "DependsOn" : "CoreOSSecurityGroup"
}
